\documentclass[twocol]{ametsoc}
\journal{mwr}

\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{siunitx}

\bibpunct{(}{)}{;}{a}{}{,}

\title{Comparison of Terrain Following and Cut Cell Grids with a Non-Hydrostatic Model}
\authors{James Shaw\correspondingauthor{Dept., Institution, Address, City, State/Country.}}
\affiliation{}
\email{j.shaw@pgr.reading.ac.uk}

\abstract{Enter the text of your abstract here.}

\begin{document}
\newcommand{\TODO}[1]{\textcolor{purple}{TODO: \emph{#1}}}

\maketitle

\section{Introduction}
Representing orography accurately in numerical weather prediction systems is necessary to model downslope winds and local precipitation patterns.  There are two main approaches to represent orography on a grid: terrain following layers and cut cells.  Both methods align cells in vertical columns.  Existing studies of cut cells have compared results with tests on terrain following grids from previous studies that used different models.  On the contrary, this study uses a single model to enable a like-for-like comparison between terrain following and cut cell grids.

With increasing model resolution, terrain can become steeper, making accurate calculation of the horizontal pressure gradient more difficult \citep{steppeler2002}.  Numerical errors in this calculation result in spurious winds and can cause numerical instability \citep{fast2003,webster2003}.  Terrain following and cut cell methods seek to reduce the error that is associated with steep orography.

With terrain following (TF) layers the terrain's influence decays with height so that the bottommost layers follow the underlying surface closely while the uppermost layers are flat.  There are two main approaches to minimizing errors associated with TF layers.  First, by smoothing the effects of terrain with height, the influence of the terrain is reduced, hence errors in the calculated horizontal pressure gradient are also reduced aloft \citep{schaer2002,leuenberger2010,klemp2011}.  However, the error is not reduced at the ground where steep terrain remains unmodified.

Second, numerical errors can also be reduced by improving the accuracy in calculating the horizontal pressure gradient itself.  TF layers are usually implemented using a coordinate transformation onto a rectangular computational domain, which introduces metric terms into the equations of motion.  The techniques proposed by \citet{klemp2011} and \cite{zaengl2012} both involve the calculation of the horizontal pressure gradient in the physical domain.  They found that, by avoiding the calculation of metric terms associated with the computational domain, numerical errors were reduced.

Despite their associated numerical errors, TF layers are in widespread operational use \citep{steppeler2003}.  They are attractive because their rectangular structure is simple to process by computer, boundary layer resolution can be increased with variable spacing of vertical layers \citep{schaer2002}, and cell sizes remain almost constant \citep{jebens2011}.

Cut cells is an alternative method in which cells that lie entirely below the terrain are removed, and those that intersect the surface are modified in shape so that they more closely fit the terrain.  The resulting grid is orthogonal everywhere except where cells have been cut.  Hence, errors are still introduced when calculating the horizontal pressure gradient between cut and uncut cells.

The cut cell method can create some very small cells which reduce computational efficiency \citep{klein2009}, and several approaches have been tried to alleviate the problem \citep{steppeler2002,yamazaki-satomura2010,jebens2011}.

Several studies have found that cut cells produce more accurate results when compared to TF coordinates.  Spurious winds seen in TF coordinates are not present and errors do not increase with steeper terrain \citep{good2014}.  \TODO{anything else?}

This study uses the nonhydrostatic model from \citet{weller-shahrokhi2014} to enable a like-for-like comparison between BTF, SLEVE and cut cell grids for idealised, two-dimensional test cases from the literature.  \TODO{final bit of intro: in section 2, section 3 etc etc}

\section{Grids}
\label{sec:grid}

\begin{figure*}
	\centering
	TODO
	%
	\caption{Examples of (a) BTF, (b) SLEVE, and (c) a cut cell grid, all constructed with OpenFOAM.  The two dimensional grids are \SI{20}{\kilo\meter} wide and \SI{2}{\kilo\meter} high.  The cut cell grid was created by intersecting the terrain surface with a regular grid as described in section~\ref{sec:grid}.}
	\label{fig:grid}
\end{figure*}

\TODO{introduce this section}
\citet{galchen-somerville1975} proposed a basic terrain following (BTF) coordinate defined as 
\begin{equation}
	z = \left( H - h \right) \left( z^\star / H \right) + h
\end{equation}
where, in two dimensions, \(z(x, z^\star)\) is the height of the coordinate surface at level \(z^\star\), \(H\) is the height of the domain, and \(h(x)\) is the height of the terrain surface.  Using this coordinate, the terrain's influence decays linearly with height but disappears only at the top of the domain.

The sigma coordinate transform of \citet{phillips1957} is equivalent to the BTF coordinate transform since they both decay linearly.  However, since they decay with pressure rather than height, sigma coordinates also change with horizontal variations in pressure.

The smooth level vertical (SLEVE) coordinate proposed by \citet{schaer2002} achieves a more regular TF grid in the middle and top of the domain than the BTF coordinate.  The terrain height is split into large-scale and small-scale components, \(h_1\) and \(h_2\), such that \(h = h_1 + h_2\), with each component having a different exponential decay. The transformation is defined as 
\begin{align}
	z &= z^\star + h_1 b_1 + h_2 b_2
\intertext{where the vertical decay functions are given by}
	b_i &= \frac{\sinh \left( \left( H / s_i \right)^n - \left( z^\star / s_i \right)^n \right)}{\sinh \left( H / s_i \right)^n}
\end{align}
with \(s_1\) and \(s_2\) are the scale heights of large-scale and small-scale terrain respectively.  The exponent \(n\) was introduced by \citet{leuenberger2010} in order to increase cell thickness in the layers nearest the ground, allowing longer timesteps and permitting more accurate calculation of parameterised low-level heat and momentum fluxes.  \citet{leuenberger2010} found the exponent has an optimal value of \(n = 1.35\).  Choosing \(n = 1\) gives the decay functions used by \citet{schaer2002}.

Most implementations of terrain following layers use a coordinate system that makes the domain rectangular, but introduces metric terms into the equations of motion.  Instead, the model employed in this study uses Cartesian coordinates and unstructured grids.  By doing so, results from the same model can be compared between terrain following and cut cell grids without modifying the equation set or discretisation.

The OpenFOAM utility \texttt{snappyHexMesh} was used to create a grid that approximates the cut cell method.  First, a custom utility was used to move points beneath the surface up to the surface creating small cells near mountain peaks.  Second, the surface faces were taken from the BTF grid and \texttt{snappyHexMesh} was used to intersect the surface with the grid.  The tool removes cells whose centres are below the surface.  An example of the resulting grid is shown in figure~\ref{fig:grid}c.

There are two details of grid construction which mean that resulting cut cell grids can differ slightly from a typical cut cell grid created using a shaving method, as described by \citet{adcroft1997}.  First, when \texttt{snappyHexMesh} moves points along the surface according to its heuristics, some points are moved horizontally.  Second, the utility does not create new points necessary for pentagonal cells.


\section{Results}
A series of standard, two-dimensional tests were performed over idealised orography.  For each test, results on the BTF, SLEVE and cut cell grid are compared.
We use a finite volume discretisation of the fully-compressible Euler equations described by \citet{weller-shahrokhi2014}.  The model has a curl-free pressure gradient formulation, an upwind-biased cubic advection scheme, and uses a Lorenz staggering of thermodynamic variables.  No explicit diffusion is used in any of the tests.

\subsection{Advection}

Following \citet{schaer2002}, a tracer is transported above wave-shaped terrain by solving the advection equation for a prescribed horizontal wind.  This challenges the accuracy of the advection scheme in the presence of grid distortions.

The domain is \SI{300}{\kilo\meter} wide and \SI{25}{\kilo\meter} high which is discretized onto a grid with \(\Delta x = \SI{1}{\kilo\meter}\) and \(\Delta z^\star = \SI{500}{\meter}\).  The terrain is wave-shaped, specified by the surface height, \(h\), such that
\begin{subequations}
\begin{align}
	h(x) &= \cos^2 \left( \frac{\pi x}{\lambda} \right) h^\star
%
	\intertext{where}
%
	h^\star(x) &= \left\{ \begin{array}{l l}
		h_0 \cos^2 \left( \frac{\pi x}{2a} \right) & \quad \text{if $| x | < a$} \\
		0 & \quad \text{otherwise}
	\end{array} \right.
\end{align}
\end{subequations}
where $a = \SI{25}{\kilo\meter}$ is the mountain half-width, $h_0 = \SI{3}{\kilo\meter}$ is the maximum mountain height, and $\lambda = \SI{8}{\kilo\meter}$ is the wavelength.  On the SLEVE grid, the large-scale component $h_1$ is given by \(h_1(x) = h^\star(x) / 2\)
and $s_1 = \SI{15}{\kilo\meter}$ is the large scale height, and $s_2 = \SI{2.5}{\kilo\meter}$ is the small scale height.  The optimisation of SLEVE by \citet{leuenberger2010} is not used, so the exponent $n = 1$.

The wind is entirely horizontal and is prescribed as
\begin{align}
	u(z) = u_0 \left\{ \begin{array}{l l}
		1 & \quad \text{if $z \geq z_2$} \\
		\sin^2 \left( \frac{\pi}{2} \frac{z - z_1}{z_2 - z_1} \right) & \quad \text{if $z_1 < z < z_2$} \\
		0 & \quad \text{otherwise}
	\end{array} \right.	
\end{align}
where $u_0 = \SI{10}{\meter\per\second}$, $z_1 = \SI{4}{\kilo\meter}$ and $z_2 = \SI{5}{\kilo\meter}$.
This results in a constant wind aloft, and zero flow at \SI{4}{\kilo\meter} and below.

While the continuous wind field is non-divergent, this is not true of the discrete wind field on non-orthogonal grids.  A potential, $p$, is used to correct the wind field, $\bm{u}$, so that is non-divergent such that
\begin{align}
	\nabla \cdot \left( \bm{u} + \nabla p \right) = 0,
\intertext{which can be rearranged to give a Poisson equation}
	\nabla^2 p = - \nabla \cdot \bm{u}.
\end{align}

A tracer $\varphi$ is positioned upstream above the height of the terrain.  It has the shape
\begin{align}
	\varphi(x, z) &= \varphi_0 \left\{ \begin{array}{l l}
		\cos^2 \left( \frac{\pi r}{2} \right) & \quad \text{if $r \leq 1$} \\
		0 & \quad \text{otherwise}
	\end{array} \right.
%
\intertext{having radius $r$ given by}
%
	r &= \sqrt{
		\left( \frac{x - x_0}{A_x} \right)^2 + 
		\left( \frac{z - z_0}{A_z} \right)^2
	}
\end{align}
where $A_x = \SI{25}{\kilo\meter}$, $A_z = \SI{3}{\kilo\meter}$ are the horizontal and vertical half-widths respectively, and $\varphi_0 = 1$ is the maximum magnitude of the anomaly.  At $t = \SI{0}{\second}$, the anomaly is centred at $(x_0, z_0) = (\SI{-50}{\kilo\meter}, \SI{9}{\kilo\meter})$ so that the anomaly is upwind of the mountain and well above the maximum terrain height of \SI{3}{\kilo\meter}.  Analytic solutions can be found by adjusting the anomaly centre such that $x_0 = ut$.

The flux form of the advection equation, \(\partial \phi / \partial t + \nabla \cdot \left( \bm{u} \phi \right) = 0\), is solved using an upwind-biased cubic advection scheme which is non-monotonic and not flux corrected.  The time derivative is solved using a second order Runge-Kutta scheme.  \TODO{I ought to understand this method myself!}

Unlike \citet{schaer2002} who use periodic lateral boundaries, a fixed value of 0 is used at the inlet boundary and all other boundaries have zero gradient.
Tests are integrated forward in time for \SI{10000}{\second} with a timestep of \(\Delta t = \SI{25}{\second}\).

The test was executed on the BTF, SLEVE and cut cell grids, and on a regular grid with flat terrain.  Tracer contours at \(t = \SI{0}{\second}, \SI{5000}{\second}\) and \(\SI{10000}{\second}\) are shown in Figure~\ref{fig:advection-tracer}.  The result from \citet{schaer2002} using a fourth-order centred scheme and sigma coordinates (\ref{fig:advection-tracer}a) is compared with the upwind-biased cubic scheme on (\ref{fig:advection-tracer}b) the BTF grid, and (\ref{fig:advection-tracer}c) cut cell grid.

Tracer magnitude and shape are well-preserved on all grids, both above the mountain at \(t = \SI{5000}{\second}\) and past the mountain at \(t = \SI{10000}{\second}\).  Advection is most accurate on the cut cell grid (figure~\ref{fig:advection-tracer}c) and regular grid (not shown).  As found by \citet{good2014}, the result is the same on both grids.  This is to be expected since the wind is zero in the region of the ground and flow aloft is aligned with the grids.  On the BTF grid, the tracer is less distorted by the cubic upwind-biased scheme (figure~\ref{fig:advection-tracer}b) compared to the fourth-order centred scheme from \citet{schaer2002} (figure~\ref{fig:advection-tracer}a).

Minimum and maximum tracer values and \(\ell^2\) error norms on the BTF, SLEVE, cut cell and regular grids are summarised in table~\ref{tab:advection}.  The results of the cubic upwind-biased scheme on TF and regular grids are comparable with those for the fourth-order centred scheme from \citet{schaer2002}.  Error is largest on the BTF grid with \(\ell^2 = \num{0.00758}\) but significant reduced on the SLEVE grid with \(\ell^2 = \num{0.00110}\).  The error is approximately halved by changing from the SLEVE grid to the cut cell grid.

The results of the tracer advection test show that, given an advection scheme of a sufficiently high order, distortions in the grid do not significantly distort the tracer.

\begin{figure}
	\centering
	\includegraphics{../msc-publication-fig-advection-tracer/fig-advection-tracer.pdf}
%
	\caption{Horizontally advected tracer contours at \(t = \SI{0}{\second}\), \SI{5000}{\second} and \SI{10000}{\second} using (a) the fourth-order centred difference scheme with sigma coordinates from \citet{schaer2002}, and the upwind-biased cubic scheme on (b) BTF grid, (c) cut cell grid.  Contour intervals are every 0.1.  The terrain profile is also shown immediately above the ground.}
	\label{fig:advection-tracer}
\end{figure}

\begin{figure}
	\centering
	\includegraphics{../msc-publication-fig-advection-error/fig-advection-error.pdf}
	%
	\caption{Errors in horizontal tracer advection at \(t = \SI{10000}{\second}\) using (a) the fourth-order centred difference scheme with sigma coordinates from \citet{schaer2002}, (b) the upwind-biased cubic scheme on a BTF grid.  Contour intervals are every 0.01 with negative contours denoted by dashed lines.}
	\label{fig:advection-error}
\end{figure}

\begin{table}[t]
	\caption{Minimum and maximum tracer magnitudes and \(\ell^2\) error norms at \(t = \SI{10000}{\second}\) in the tracer advection test.  Results of the cubic upwind-biased scheme are compared with the fourth-order centred scheme from \citet{schaer2002}.}
\label{tab:advection}
%
\centering
\footnotesize
\begin{tabular}{ l l l l l l }
\hline\hline
& \multicolumn{3}{c}{Cubic upwind-biased} & \multicolumn{2}{c}{Sch\"ar 4th order} \\
& \(\ell^2\) error & min & max & min & max \\
\hline
Analytic  & 0 & 0 & 1 & 0 & 1 \\
BTF 	  & \num{-1} & \num{-1} & \num{-1} & \num{-0.058} & \num{1.001} \\
SLEVE 	  & \num{-1} & \num{-1} & \num{-1} & \num{-0.002} & \num{0.984} \\
Cut cell  & \num{-1} & \num{-1} & \num{-1} & \multicolumn{1}{c}{---} & \multicolumn{1}{c}{---} \\
No orography & \num{-1} & \num{-1} & \num{-1} & \num{-0.002} & \num{0.984} \\
\hline
\end{tabular}
\end{table}


\subsection{Resting atmosphere}
An idealised terrain profile is defined along with a stratified atmosphere at rest in hydrostatic balance.  The analytic solution is time-invariant, but numerical errors in calculating the horizontal pressure gradient can give rise to spurious velocities which become more severe over steeper terrain \citet{klemp2011}.

The test setup follows the specification by \cite{klemp2011}, but has a narrower domain that is \SI{20}{\kilo\meter} wide and \SI{20}{\kilo\meter} high in order to reduce simulation time, as used by \citet{weller-shahrokhi2014}.  The grid resolution is \(\Delta x = \Delta z^\star = \SI{500}{\meter}\) as originally specified by \citet{klemp2011}.  All boundary conditions are no normal flow.

The wave-shaped mountain profile has a surface height, $h$, given by
\begin{align}
	h(x) = h_0 \exp \left( - \left( \frac{x}{a} \right)^2 \right) \cos^2 \left( \frac{\pi x}{\lambda} \right) \label{eqn:resting:mountain}
\end{align}
where $a = \SI{5}{\kilo\meter}$ is the mountain half-width, $h_0 = \SI{1}{\kilo\meter}$ is the maximum mountain height and $\lambda = \SI{4}{\kilo\meter}$ is the wavelength.  For the optimised SLEVE grid, the large-scale component $h_1$ is specified as
\begin{align}
h_1(x) = \frac{1}{2} h_0 \exp \left( - \left( \frac{x}{a} \right)^2 \right)
\end{align}
and, following \cite{leuenberger2010}, $s_1 = \SI{4}{\kilo\meter}$ is the large scale height, $s_2 = \SI{1}{\kilo\meter}$ is the small scale height, and the optimal exponent value of $n = 1.35$ is used.

The initial thermodynamic conditions are in discrete hydrostatic balance, having a surface temperature of $\theta_0 = \SI{288}{\kelvin}$ and constant stability with Brunt-V\"ais\"al\"a frequency $N = \SI{0.01}{\per\second}$ everywhere, except for a more stable layer of $N = \SI{0.02}{\per\second}$ between $\SI{2}{\kilo\meter} \leq z \leq \SI{3}{\kilo\meter}$.  Unlike \citet{klemp2011}, there is no eddy diffusion in the equation set.

The test was integrated forward by 5 hours on the BTF, SLEVE and cut cell grids, and a regular grid with flat terrain.  Maximum vertical velocities are compared with the results from \citet{klemp2011} in figure~\ref{fig:resting} (note different vertical scales).  In agreement with \citet{klemp2011}, vertical velocities are larger on more distorted grids.  However, magnitudes are smaller comparing results on the terrain following grids with those from \citet{klemp2011}, with $w$ reaching a maximum of \(\sim \SI{0.35}{\meter\per\second}\) on the BTF grid in our test compared with a maximum of \(\sim \SI{10}{\meter\per\second}\) found by \citet{klemp2011}.

Unlike the result from \citet{klemp2011}, the SLEVE grid does not significantly reduce vertical velocities compared to the BTF grid.  However, errors are three orders of magnitude smaller on the cut cell grid with vertical velocities of \(\sim \SI{1e-3}{\meter\per\second}\).  The smallest error of \(\sim \SI{1e-10}{\meter\per\second}\) is found on the regular grid.

\citet{good2014} found the maximum vertical velocity in their cut cell model was \SI{1e-12}{\meter\per\second}, which is better than any result obtained using the model by \citet{weller-shahrokhi2014}.  It is worth noting that \citet{good2014} used a timestep of \SI{1.01}{\second} instead of the \SI{100}{\second} timestep specified by \citet{klemp2011} that was used to obtain the results presented here.  In addition, in the model used by \citet{good2014}, cell centres are in the centre of the uncut cell, resulting in the centre of some cut cells being below the ground (S.-J. Lock 2014, personal communication).  This means that the grid is effectively regular when calculating horizontal and vertical gradients.  These two modelling decisions may account for the very small velocities found by \citet{good2014}.

In summary, spurious velocities in the resting atmosphere test were similar on both terrain following grids, with much lower errors compared to those from \citet{klemp2011}.  The maximum vertical velocity was significantly decreased on the cut cell grid, so we conclude that non-orthogonality is a significant cause of numerical error in this test.

\begin{figure*}
	\centering
	\includegraphics{../msc-publication-fig-resting/fig-resting.pdf}
%
	\caption{Maximum spurious vertical velocity, \(w\) (\si{\meter\per\second}), in the resting atmosphere test with results on (a) BTF, SLEVE, Hybrid Terrain Following (HTF) and Smoothed Terrain Following (STF) coordinates from \citet{klemp2011}, (b) BTF, SLEVE, cut cell and regular grids using the model from \citet{weller-shahrokhi2014}.  Note that vertical scales differ.}
	\label{fig:resting}
\end{figure*}

\subsection{Gravity waves}
\TODO{introduce and motivate the test... it models a real dynamic process}

Following \citet{melvin2010}, the domain is \SI{300}{\kilo\meter} wide and \SI{30}{\kilo\meter} high.  The mountain profile has the same form as equation~\ref{eqn:resting:mountain}.  Tests are performed with mountain heights of $h_0 = \SI{250}{\meter}$ and \(h_0 = \SI{500}{\meter}\).  As in the resting atmosphere test, $a = \SI{5}{\kilo\meter}$ is the mountain half-width and $\lambda = \SI{4}{\kilo\meter}$ is the wavelength.  On the optimised SLEVE grid, $s_1 = \SI{5}{\kilo\meter}$ is the large scale height, $s_2 = \SI{2}{\kilo\meter}$ is the small scale height and the optimal exponent value $n = 1.35$ is used.

The initial thermodynamic conditions have a surface temperature of $\theta_0 = \SI{288}{\kelvin}$ and constant stability with $N = \SI{0.01}{\per\second}$ everywhere.  A constant horizontal wind $u = \SI{10}{\meter\per\second}$ is prescribed at the inlet boundary.

Sponge layers are added to the upper \SI{10}{\kilo\meter} and leftmost \SI{10}{\kilo\meter} at the inlet boundary to damp the reflection of waves.
The term $\mu \rho \bf{u}$ is subtracted from the momentum equation \TODO{include the equation set in this paper, or cite weller-shahrokhi2014 here?} where the damping function $\mu$ is adapted from \citet{melvin2010} such that
\begin{align}
	\mu(x, z) &= \mu_\mathrm{upper} + \mu_\mathrm{inlet} \\
	\mu_\mathrm{upper}(z) &= \begin{cases}
		\overline{\mu} \sin^2 \left( \frac{\pi}{2} \frac{z - z_B}{H - z_B} \right) & \text{if } z \geq z_B \\
		0 & \text{otherwise} \\
	\end{cases} \\
	\mu_\mathrm{inlet}(x) &= \begin{cases}
		\overline{\mu} \sin^2 \left( \frac{\pi}{2} \frac{x_I - x}{x_I - x_0} \right) & \text{if } x < x_I \\
		0 & \text{otherwise}
	\end{cases}
\end{align}
where $\overline{\mu} = 1.2$ is the damping coefficient, $z_B = \SI{20}{\kilo\meter}$ is the bottom of the sponge layer, $H = \SI{30}{\kilo\meter}$ is the top of the domain, $x_0 = \SI{-150}{\kilo\meter}$ is the leftmost limit of the domain and $x_I = \SI{-140}{\kilo\meter}$ is the rightmost extent of the inlet sponge layer.  The sponge layer is only active on faces whose normal is vertical so that it damps vertical momentum only.

Note that, while the domain itself is \SI{30}{\kilo\meter} in height, for the purposes of generating of BTF and SLEVE grids, the domain height is set to \SI{20}{\kilo\meter} because the sponge layer occupies the uppermost \SI{10}{\kilo\meter}.

No normal flow is imposed at the top and bottom boundaries and the outlet is zero gradient.  For Exner, hydrostatic balance is prescribed on all boundaries.  The simulation is integrated forward by 5 hours with a timestep $\Delta t = \SI{8}{\second}$.

Test results are compared between the BTF, SLEVE and cut cell grids.  Vertical velocities on the BTF grid are shown in figure~\ref{fig:gw-w}a, which have few visible differences from results on the SLEVE and cut cell grids (not shown).  Vertical velocities on all grids are in agreement with the high resolution solution from \citet{melvin2010}, shown in figure~\ref{fig:gw-w}b.

The initial thermal profile is subtracted from the potential temperature field at the end of the integration to reveal the structure of thermal anomalies.  Once again, the results are similar on all three grids, and results are shown on the BTF and cut cell grids in figures~\ref{fig:gw-theta}a and \ref{fig:gw-theta}c respectively.  However, examining more closely the anomalies in the lee of the mountain, figure~\ref{fig:gw-theta}d shows that the bottommost layer is anomalously warm and the layer above it is anomalously cold.  This feature is not present on the BTF grid (figure~\ref{fig:gw-theta}b) or the SLEVE grid (not shown).  

In a further test, the mountain height is doubled from \SI{250}{\meter} to \SI{500}{\meter} with all other parameter values unchanged.  The same spurious anomaly in potential temperature is present on the cut cell grid but its amplitude increases.  Figure~\ref{fig:gw-exner-theta} shows vertical profiles of the Exner function of pressure and potential temperature in the lowest \SI{1}{\kilo\meter} in the lee of the mountain at \(x = \SI{50}{\kilo\meter}\).  

Analysis:
\begin{itemize}
	\item \TODO{divergence might help explain computational mode -- it's greater on the SnapCol grid (MSc dissertation Figure 4.15e)}
	\item \TODO{worth mentioning implications of this?  1. reduced stability, although not enough to create vertical motion in this instance 2. would disrupt clouds 2. model has no viscosity so thermal mixing should not occur in theory}
	\item Lorenz computation mode has been excited because Exner sample line at $x = \SI{50}{\kilo\meter}$ is in hydrostatic balance (Figure~\ref{fig:gw-exner-theta})
	\item \TODO{We can speculate on what excites the computational mode, but perhaps better not to?}
	\item No evidence of small cell problem -- \TODO{don't know that we can say much here without another vertical momentum test; our hypothesis about the quasi-horizontal flow isn't backed up with a test case}
	\item Conclusion: results similar on all grids, agree with literature, except for Lorenz computational mode on SnapCol grid
\end{itemize}

\begin{figure}
	\centering
	\includegraphics{../msc-publication-fig-gravityWaves/fig-gravityWaves.pdf}
%
	\caption{Vertical cross section of vertical velocity contours in the gravity waves test after 5 hours on (a) the BTF grid compared with (b) the mass-conserving semi-implicit semi-Lagrangian solution from \citet{melvin2010}.  Contours are every \SI{5e-2}{\meter\per\second} with solid lines denoting ascent and dashed lines descent.}
	\label{fig:gw-w}
\end{figure}

\begin{figure*}
	\centering
	\includegraphics{../msc-publication-fig-gravityWaves-theta/fig-gravityWaves-theta.pdf}
%
	\caption{Anomalies in potential temperature in the gravity waves test after 5 hours with a mountain height, \(h_0 = \SI{250}{\meter}\).  The central domain in the lowest \SI{12}{\kilo\meter} is shown on (a) the BTF grid, and (c) the cut cell grid.  The four lowest layers of each grid are shown for (b) BTF, and (d) cut cell grids, using a narrower potential temperature scale.  The results on the SLEVE grid (not shown) are qualitatively identical to results on the BTF grid.}
	\label{fig:gw-theta}
\end{figure*}

\begin{figure}
	\centering
	\includegraphics{../msc-publication-fig-gravityWaves-sampleLine/fig-gravityWaves-sampleLine.pdf}
%
	\caption{Vertical profiles of the Exner function of pressure, \(\Pi\), and potential temperature, \(\theta\), in the gravity waves test with a mountain height of \(h_0 = \SI{500}{\meter}\).  Exner profile is visually identical on all grids for both mountain heights; for clarity, the Exner profile is only plotted for the BTF grid.  The computational mode is manifested as a zig-zag in potential temperature on the cut cell grid which.   Results on the SLEVE grid (not shown) are qualitatively the same as those on the BTF grid.  The thermal profile with a lesser mountain height of \(h_0 = \SI{250}{\meter}\) (not shown) exhibits a computational mode with smaller amplitude.}
	\label{fig:gw-exner-theta}
\end{figure}


\section{Conclusions}
\begin{enumerate}
	\item BTF grid isn't as bad as people say it is.  We found that:
	\begin{itemize}
		\item Upwind-biased cubic advection scheme accurately advects a tracer in non-divergent flows (Figure~\ref{fig:advection-tracer}, \ref{fig:advection-error}, Table~\ref{tab:advection})
		\item spurious vertical velocities are small in resting atmosphere (Figure~\ref{fig:resting})
		\item gravity waves results visually as good as reference solution from \citet{melvin2010} (figure~\ref{fig:gw-w})
	\end{itemize}

	\item Cut cell grids can be worse than TF grids:
	\begin{itemize}
		\item Lorenz computational mode found on SnapCol grid only (figure~\ref{fig:gw-theta}, \ref{fig:gw-exner-theta})
	\end{itemize}

	\item Cut cell grids can also be better than TF grids in more artificial test cases:
	\begin{itemize}
		\item SnapCol $w$ two orders of magnitude smaller in resting atmosphere test
		\item SnapCol advection test as good as noOrography
	\end{itemize}
\end{enumerate}

\textbf{With the exception of the Lorenz computational mode on the SnapCol grid in the gravity waves test, results were satisfactory across BTF, SLEVE and SnapCol grids in all three test cases.}

Miscellany:
\begin{itemize}
	\item Advection accuracy depends on alignment of the flow with grid layers (\TODO{we kinda need wobblyTracerAdvection to reach this conclusion})
\end{itemize}

\section{Further work}
\begin{itemize}
	\item Lorenz computational mode motivates formulation of C-P staggering for cut cell grids
	\item Find out what excites the Lorenz computational mode
	\item \TODO{anything else?}
\end{itemize}

\acknowledgments
Start acknowledgments here.

% REFERENCES

\bibliographystyle{ametsoc2014}
\bibliography{references}

% TABLES


% FIGURES

\end{document}
